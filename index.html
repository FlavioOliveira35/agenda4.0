<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Código-fonte da Agenda Diária 5.0</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/_@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
</head>
       
        

    <style>
        /* Reset e estilos base */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f8f7fa;
            color: #333;
            line-height: 1.6;
        }
        
        /* Cabeçalho */
        .app-header {
            background: linear-gradient(135deg, #8a4baf 0%, #6a3093 100%);
            color: white;
            padding: 0.5rem 0;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .app-title {
            text-align: center;
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }
        
        .date-nav {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0.5rem;
        }
        
        .date-display {
            font-size: 1.2rem;
            margin: 0 1rem;
            min-width: 200px;
            text-align: center;
        }
        
        .nav-btn {
            background-color: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.2s;
        }
        
        .nav-btn:hover {
            background-color: rgba(255, 255, 255, 0.3);
        }
        
        /* Navegação principal */
        .main-nav {
            display: flex;
            border-bottom: 1px solid #e0e0e0;
            background-color: white;
        }
        
        .nav-tab {
            flex: 1;
            text-align: center;
            padding: 1rem 0;
            cursor: pointer;
            transition: all 0.2s;
            color: #666;
            font-weight: 500;
        }
        
        .nav-tab.active {
            color: #6a3093;
            border-bottom: 3px solid #6a3093;
        }
        
        .nav-tab:hover:not(.active) {
            background-color: #f9f9f9;
        }
        
        /* Conteúdo principal */
        .content {
            padding: 1rem;
            max-width: 800px;
            margin: 0 auto;
        }
        
        /* Estilo das tarefas */
        .task-list {
            list-style: none;
        }
        
        .task-item {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
            padding: 1rem;
            margin-bottom: 1rem;
            position: relative;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .task-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .task-header {
            display: flex;
            align-items: center;
            margin-bottom: 0.5rem;
        }
        
        .task-time {
            background-color: #f0f0f0;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.8rem;
            margin-right: 0.5rem;
        }
        
        .task-title {
            font-weight: 600;
            flex: 1;
        }
        
        .task-description {
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
        }
        
        .task-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 0.5rem;
        }
        
        /* Prioridades */
        .priority-critical {
            border-left: 4px solid #e74c3c;
        }
        
        .priority-attention {
            border-left: 4px solid #f39c12;
        }
        
        .priority-normal {
            border-left: 4px solid #2ecc71;
        }
        
        /* Botões */
        .btn {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: background-color 0.2s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }
        
        .btn-primary {
            background-color: #6a3093;
            color: white;
        }
        
        .btn-primary:hover {
            background-color: #8a4baf;
        }
        
        .btn-secondary {
            background-color: #f0f0f0;
            color: #333;
        }
        
        .btn-secondary:hover {
            background-color: #e0e0e0;
        }
        
        .btn-success {
            background-color: #2ecc71;
            color: white;
        }
        
        .btn-success:hover {
            background-color: #27ae60;
        }
        
        .btn-danger {
            background-color: #e74c3c;
            color: white;
        }
        
        .btn-danger:hover {
            background-color: #c0392b;
        }
        
        .btn-sm {
            padding: 0.25rem 0.5rem;
            font-size: 0.8rem;
        }
        
        .btn-icon {
            margin-right: 0.5rem;
        }
        
        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            display: none;
        }
        
        .modal {
            background-color: white;
            border-radius: 8px;
            width: 90%;
            max-width: 500px;
            padding: 1.5rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }
        
        .modal-title {
            font-size: 1.2rem;
            font-weight: 600;
        }
        
        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #666;
        }
        
        .form-group {
            margin-bottom: 1rem;
        }
        
        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
        }
        
        .form-control {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 1rem;
        }
        
        .form-select {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 1rem;
            background-color: white;
        }
        
        .form-check {
            display: flex;
            align-items: center;
            margin-bottom: 0.5rem;
        }
        
        .form-check-input {
            margin-right: 0.5rem;
        }
        
        .modal-footer {
            display: flex;
            justify-content: flex-end;
            margin-top: 1rem;
        }
        
        .modal-footer .btn {
            margin-left: 0.5rem;
        }
        
        /* Comentários */
        .comments-section {
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid #eee;
        }
        
        .comment-list {
            list-style: none;
            margin-bottom: 1rem;
        }
        
        .comment-item {
            background-color: #f9f9f9;
            padding: 0.75rem;
            border-radius: 4px;
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
        }
        
        .comment-time {
            font-size: 0.8rem;
            color: #999;
        }
        
        .comment-image {
            max-width: 100%;
            border-radius: 4px;
            margin-top: 0.5rem;
        }
        
        .comment-form {
            display: flex;
            margin-top: 0.5rem;
        }
        
        .comment-input {
            flex: 1;
            padding: 0.5rem;
            border: 1px solid #ddd;
            border-radius: 4px 0 0 4px;
        }
        
        .comment-btn {
            border-radius: 0 4px 4px 0;
        }
        
        /* Badge */
        .badge {
            display: inline-block;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 600;
        }
        
        .badge-primary {
            background-color: #6a3093;
            color: white;
        }
        
        .badge-success {
            background-color: #2ecc71;
            color: white;
        }
        
        .badge-warning {
            background-color: #f39c12;
            color: white;
        }
        
        .badge-danger {
            background-color: #e74c3c;
            color: white;
        }
        
        /* Visualização semanal */
        .week-view {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 0.5rem;
            margin-top: 1rem;
        }
        
        .week-day {
            background-color: white;
            border-radius: 8px;
            padding: 1rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
        }
        
        .week-day-header {
            text-align: center;
            padding-bottom: 0.5rem;
            margin-bottom: 0.5rem;
            border-bottom: 1px solid #eee;
        }
        
        .day-name {
            font-weight: 600;
            color: #6a3093;
        }
        
        .day-tasks {
            min-height: 100px;
        }
        
        .week-task {
            background-color: #f9f9f9;
            padding: 0.5rem;
            border-radius: 4px;
            margin-bottom: 0.5rem;
            font-size: 0.85rem;
            border-left: 3px solid #ddd;
        }
        
        .week-task.priority-critical {
            background-color: rgba(231, 76, 60, 0.1);
        }
        
        .week-task.priority-attention {
            background-color: rgba(243, 156, 18, 0.1);
        }
        
        .week-task.priority-normal {
            background-color: rgba(46, 204, 113, 0.1);
        }
        
        /* Relatórios */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }
        
        .stat-card {
            background-color: white;
            border-radius: 8px;
            padding: 1rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
        }
        
        .stat-title {
            font-size: 1rem;
            color: #666;
            margin-bottom: 0.5rem;
        }
        
        .stat-value {
            font-size: 2rem;
            font-weight: 600;
            color: #6a3093;
        }
        
        .chart-container {
            background-color: white;
            border-radius: 8px;
            padding: 1rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
            margin-bottom: 1rem;
        }
        
        /* Botão flutuante de adicionar */
        .floating-btn {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background-color: #6a3093;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            cursor: pointer;
            transition: all 0.2s;
            border: none;
            font-size: 1.5rem;
        }
        
        .floating-btn:hover {
            background-color: #8a4baf;
            transform: translateY(-2px);
            box-shadow: 0 6px 8px rgba(0, 0, 0, 0.15);
        }
        
        /* Alertas e notificações */
        .alert {
            padding: 1rem;
            border-radius: 4px;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
        }
        
        .alert-success {
            background-color: rgba(46, 204, 113, 0.1);
            border-left: 4px solid #2ecc71;
            color: #27ae60;
        }
        
        .alert-warning {
            background-color: rgba(243, 156, 18, 0.1);
            border-left: 4px solid #f39c12;
            color: #e67e22;
        }
        
        .alert-danger {
            background-color: rgba(231, 76, 60, 0.1);
            border-left: 4px solid #e74c3c;
            color: #c0392b;
        }
        
        .alert-icon {
            margin-right: 0.5rem;
            font-size: 1.2rem;
        }
        
        /* Responsividade */
        @media (max-width: 768px) {
            .week-view {
                grid-template-columns: 1fr;
            }
            
            .week-day {
                margin-bottom: 1rem;
            }
        }
        
        /* Dias de recorrência */
        .recurrence-days {
            display: flex;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }
        
        .day-checkbox {
            display: none;
        }
        
        .day-label {
            width: 35px;
            height: 35px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            background-color: #f0f0f0;
            cursor: pointer;
            font-size: 0.8rem;
            transition: all 0.2s;
        }
        
        .day-checkbox:checked + .day-label {
            background-color: #6a3093;
            color: white;
        }
        
        /* Ícones */
        .icon {
            display: inline-block;
            width: 24px;
            height: 24px;
            stroke-width: 0;
            stroke: currentColor;
            fill: currentColor;
            line-height: 1;
        }
        
        .icon-sm {
            width: 18px;
            height: 18px;
        }
        
        .icon-lg {
            width: 30px;
            height: 30px;
        }
        
        /* Ocultar elementos */
        .hidden {
            display: none !important;
        }
    </style>
</head>
<body>
    <!-- Cabeçalho do aplicativo -->
    <header class="app-header">
        <h1 class="app-title">Agenda Diária</h1>
        <div class="date-nav">
            <button class="nav-btn" id="prevDay">
                <svg class="icon" viewBox="0 0 24 24">
                    <path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"></path>
                </svg>
            </button>
            <div class="date-display" id="currentDate">carregando...</div>
            <button class="nav-btn" id="nextDay">
                <svg class="icon" viewBox="0 0 24 24">
                    <path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"></path>
                </svg>
            </button>
        </div>
    </header>

    <!-- Navegação principal -->
    <nav class="main-nav">
        <div class="nav-tab active" data-tab="agenda">
            <svg class="icon icon-sm" viewBox="0 0 24 24">
                <path d="M19 3h-1V1h-2v2H8V1H6v2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11zM5 5v2h14V5H5z"></path>
            </svg>
            Agenda
        </div>
        <div class="nav-tab" data-tab="semana">
            <svg class="icon icon-sm" viewBox="0 0 24 24">
                <path d="M4 11h5V5H4v6zm0 7h5v-6H4v6zm6 0h5v-6h-5v6zm6 0h5v-6h-5v6zm-6-7h5V5h-5v6zm6-6v6h5V5h-5z"></path>
            </svg>
            Semana
        </div>
        <div class="nav-tab" data-tab="relatorios">
            <svg class="icon icon-sm" viewBox="0 0 24 24">
                <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"></path>
            </svg>
            Relatórios
        </div>
    </nav>

    <!-- Conteúdo principal -->
    <main class="content">
        <!-- Seção Agenda (visível por padrão) -->
        <section id="agenda-section" class="tab-content">
            <div id="tasks-container" class="task-list">
                <!-- As tarefas serão inseridas aqui dinamicamente -->
                <div class="alert alert-info">
                    <svg class="icon alert-icon" viewBox="0 0 24 24">
                        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"></path>
                    </svg>
                    <div>Nenhuma tarefa para hoje. Adicione uma nova tarefa clicando no botão +</div>
                </div>
            </div>
        </section>

        <!-- Seção Semana (inicialmente oculta) -->
        <section id="semana-section" class="tab-content hidden">
            <div class="week-view" id="week-view-container">
                <!-- Os dias da semana serão inseridos aqui dinamicamente -->
            </div>
        </section>

        <!-- Seção Relatórios (inicialmente oculta) -->
        <section id="relatorios-section" class="tab-content hidden">
            <h2 class="section-title">Resumo de Atividades</h2>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-title">Tarefas concluídas esta semana</div>
                    <div class="stat-value" id="tasks-completed">0</div>
                    <div class="stat-subtitle" id="tasks-completed-ratio">concluídas de 0 tarefas</div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-title">Pontualidade</div>
                    <div class="stat-value" id="tasks-on-time">0</div>
                    <div class="stat-subtitle" id="tasks-on-time-ratio">no horário de 0 executadas</div>
                </div>
            </div>
            
            <div class="chart-container">
                <h3 class="chart-title">Distribuição por Prioridade</h3>
                <div class="chart-content">
                    <div>Crítica <span id="priority-critical-percent">0%</span></div>
                    <div>Atenção <span id="priority-attention-percent">0%</span></div>
                    <div>Normal <span id="priority-normal-percent">0%</span></div>
                </div>
            </div>
        </section>
    </main>

    <!-- Botão flutuante de adicionar tarefa -->
    <button class="floating-btn" id="addTaskBtn">
        <svg class="icon" viewBox="0 0 24 24">
            <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"></path>
        </svg>
    </button>

    <!-- Modal de Adicionar/Editar Tarefa -->
    <div class="modal-overlay" id="taskModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title" id="taskModalTitle">Adicionar Nova Tarefa</h3>
                <button class="modal-close" id="closeTaskModal">&times;</button>
            </div>
            <form id="taskForm">
                <input type="hidden" id="taskId">
                <div class="form-group">
                    <label class="form-label" for="taskTitle">Título*</label>
                    <input type="text" class="form-control" id="taskTitle" required>
                </div>
                <div class="form-group">
                    <label class="form-label" for="taskDescription">Descrição</label>
                    <textarea class="form-control" id="taskDescription" rows="3"></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">Horário*</label>
                    <div class="flex" style="display: flex; gap: 10px;">
                        <div style="flex: 1;">
                            <label class="form-label" for="taskStartTime">Início</label>
                            <input type="time" class="form-control" id="taskStartTime" required>
                        </div>
                        <div style="flex: 1;">
                            <label class="form-label" for="taskEndTime">Fim</label>
                            <input type="time" class="form-control" id="taskEndTime" required>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label" for="taskPriority">Prioridade*</label>
                    <select class="form-select" id="taskPriority" required>
                        <option value="normal">Normal</option>
                        <option value="attention">Atenção</option>
                        <option value="critical">Crítica</option>
                    </select>
                </div>
                <div class="form-group">
                    <div class="form-check">
                        <input type="checkbox" id="taskRecurrent" class="form-check-input">
                        <label for="taskRecurrent" class="form-check-label">Tarefa Recorrente</label>
                    </div>
                </div>
                <div id="recurrenceOptions" class="hidden">
                    <div class="form-group">
                        <div class="form-check">
                            <input type="radio" name="recurrenceType" id="recurrenceDaily" value="daily" class="form-check-input" checked>
                            <label for="recurrenceDaily" class="form-check-label">Todos os dias</label>
                        </div>
                        <div class="form-check">
                            <input type="radio" name="recurrenceType" id="recurrenceSpecific" value="specific" class="form-check-input">
                            <label for="recurrenceSpecific" class="form-check-label">Dias específicos</label>
                        </div>
                    </div>
                    <div id="specificDays" class="hidden">
                        <div class="recurrence-days">
                            <input type="checkbox" id="day-0" class="day-checkbox" value="0">
                            <label for="day-0" class="day-label">D</label>
                            
                            <input type="checkbox" id="day-1" class="day-checkbox" value="1">
                            <label for="day-1" class="day-label">S</label>
                            
                            <input type="checkbox" id="day-2" class="day-checkbox" value="2">
                            <label for="day-2" class="day-label">T</label>
                            
                            <input type="checkbox" id="day-3" class="day-checkbox" value="3">
                            <label for="day-3" class="day-label">Q</label>
                            
                            <input type="checkbox" id="day-4" class="day-checkbox" value="4">
                            <label for="day-4" class="day-label">Q</label>
                            
                            <input type="checkbox" id="day-5" class="day-checkbox" value="5">
                            <label for="day-5" class="day-label">S</label>
                            
                            <input type="checkbox" id="day-6" class="day-checkbox" value="6">
                            <label for="day-6" class="day-label">S</label>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" id="cancelTaskBtn">Cancelar</button>
                    <button type="submit" class="btn btn-primary" id="saveTaskBtn">
                        <svg class="icon icon-sm btn-icon" viewBox="0 0 24 24">
                            <path d="M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7l-4-4zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3zm3-10H5V5h10v4z"></path>
                        </svg>
                        Salvar
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal de Comentários -->
    <div class="modal-overlay" id="commentsModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Comentários</h3>
                <button class="modal-close" id="closeCommentsModal">&times;</button>
            </div>
            <div class="comments-section">
                <ul class="comment-list" id="commentsList">
                    <!-- Os comentários serão inseridos aqui dinamicamente -->
                </ul>
                
                <form id="commentForm">
                    <input type="hidden" id="commentTaskId">
                    <div class="form-group">
                        <label class="form-label" for="commentText">Novo comentário</label>
                        <textarea class="form-control" id="commentText" rows="2" required></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="commentImage">Imagem (opcional)</label>
                        <input type="file" class="form-control" id="commentImage" accept="image/*">
                    </div>
                    <div class="modal-footer">
                        <button type="submit" class="btn btn-primary" id="addCommentBtn">
                            <svg class="icon icon-sm btn-icon" viewBox="0 0 24 24">
                                <path d="M20 2H4c-1.1 0-1.99.9-1.99 2L2 22l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-2 12H6v-2h12v2zm0-3H6V9h12v2zm0-3H6V6h12v2z"></path>
                            </svg>
                            Adicionar Comentário
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        // Constantes e Variáveis Globais
        const monthNames = [
            "janeiro", "fevereiro", "março", "abril", "maio", "junho",
            "julho", "agosto", "setembro", "outubro", "novembro", "dezembro"
        ];
        
        const dayNames = [
            "domingo", "segunda-feira", "terça-feira", "quarta-feira", 
            "quinta-feira", "sexta-feira", "sábado"
        ];
        
        const shortDayNames = ["Dom", "Seg", "Ter", "Qua", "Qui", "Sex", "Sáb"];
        
        // Estado da aplicação
        let currentDate = new Date();
        let tasks = [];
        let editingTaskId = null;
        
        // Elementos DOM
        const currentDateEl = document.getElementById('currentDate');
        const prevDayBtn = document.getElementById('prevDay');
        const nextDayBtn = document.getElementById('nextDay');
        const tasksContainer = document.getElementById('tasks-container');
        const weekViewContainer = document.getElementById('week-view-container');
        const addTaskBtn = document.getElementById('addTaskBtn');
        const taskModal = document.getElementById('taskModal');
        const closeTaskModal = document.getElementById('closeTaskModal');
        const cancelTaskBtn = document.getElementById('cancelTaskBtn');
        const taskForm = document.getElementById('taskForm');
        const taskModalTitle = document.getElementById('taskModalTitle');
        const taskIdInput = document.getElementById('taskId');
        const taskTitleInput = document.getElementById('taskTitle');
        const taskDescriptionInput = document.getElementById('taskDescription');
        const taskStartTimeInput = document.getElementById('taskStartTime');
        const taskEndTimeInput = document.getElementById('taskEndTime');
        const taskPriorityInput = document.getElementById('taskPriority');
        const taskRecurrentInput = document.getElementById('taskRecurrent');
        const recurrenceOptions = document.getElementById('recurrenceOptions');
        const recurrenceDailyInput = document.getElementById('recurrenceDaily');
        const recurrenceSpecificInput = document.getElementById('recurrenceSpecific');
        const specificDays = document.getElementById('specificDays');
        const commentsModal = document.getElementById('commentsModal');
        const closeCommentsModal = document.getElementById('closeCommentsModal');
        const commentsList = document.getElementById('commentsList');
        const commentForm = document.getElementById('commentForm');
        const commentTaskIdInput = document.getElementById('commentTaskId');
        const commentTextInput = document.getElementById('commentText');
        const commentImageInput = document.getElementById('commentImage');
        const navTabs = document.querySelectorAll('.nav-tab');
        const tabContents = document.querySelectorAll('.tab-content');
        
        // Estatísticas
        const tasksCompletedEl = document.getElementById('tasks-completed');
        const tasksCompletedRatioEl = document.getElementById('tasks-completed-ratio');
        const tasksOnTimeEl = document.getElementById('tasks-on-time');
        const tasksOnTimeRatioEl = document.getElementById('tasks-on-time-ratio');
        const priorityCriticalPercentEl = document.getElementById('priority-critical-percent');
        const priorityAttentionPercentEl = document.getElementById('priority-attention-percent');
        const priorityNormalPercentEl = document.getElementById('priority-normal-percent');
        
        // Inicialização da Aplicação
        document.addEventListener('DOMContentLoaded', () => {
            // Carregar tarefas do armazenamento local
            loadTasks();
            
            // Atualizar exibição da data atual
            updateDateDisplay();
            
            // Renderizar tarefas
            renderTasks();
            
            // Renderizar visualização semanal
            renderWeekView();
            
            // Renderizar estatísticas
            updateStatistics();
            
            // Configurar event listeners
            setupEventListeners();
        });
        
        // Funções principais
        function setupEventListeners() {
            // Navegação de datas
            prevDayBtn.addEventListener('click', () => {
                currentDate.setDate(currentDate.getDate() - 1);
                updateDateDisplay();
                renderTasks();
            });
            
            nextDayBtn.addEventListener('click', () => {
                currentDate.setDate(currentDate.getDate() + 1);
                updateDateDisplay();
                renderTasks();
            });
            
            // Navegação de abas
            navTabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    // Remover classe active de todas as abas
                    navTabs.forEach(t => t.classList.remove('active'));
                    
                    // Adicionar classe active à aba clicada
                    tab.classList.add('active');
                    
                    // Ocultar todas as seções de conteúdo
                    tabContents.forEach(content => content.classList.add('hidden'));
                    
                    // Exibir a seção de conteúdo correspondente
                    const tabId = tab.dataset.tab;
                    document.getElementById(`${tabId}-section`).classList.remove('hidden');
                    
                    // Atualizar conteúdo específico da aba
                    if (tabId === 'semana') {
                        renderWeekView();
                    } else if (tabId === 'relatorios') {
                        updateStatistics();
                    }
                });
            });
            
            // Manipulação do modal de tarefas
            addTaskBtn.addEventListener('click', () => {
                openTaskModal();
            });
            
            closeTaskModal.addEventListener('click', () => {
                taskModal.style.display = 'none';
            });
            
            cancelTaskBtn.addEventListener('click', () => {
                taskModal.style.display = 'none';
            });
            
            taskForm.addEventListener('submit', (e) => {
                e.preventDefault();
                saveTask();
            });
            
            // Manipulação de tarefas recorrentes
            taskRecurrentInput.addEventListener('change', () => {
                if (taskRecurrentInput.checked) {
                    recurrenceOptions.classList.remove('hidden');
                } else {
                    recurrenceOptions.classList.add('hidden');
                }
            });
            
            recurrenceSpecificInput.addEventListener('change', () => {
                if (recurrenceSpecificInput.checked) {
                    specificDays.classList.remove('hidden');
                } else {
                    specificDays.classList.add('hidden');
                }
            });
            
            recurrenceDailyInput.addEventListener('change', () => {
                if (recurrenceDailyInput.checked) {
                    specificDays.classList.add('hidden');
                }
            });
            
            // Manipulação do modal de comentários
            closeCommentsModal.addEventListener('click', () => {
                commentsModal.style.display = 'none';
            });
            
            commentForm.addEventListener('submit', (e) => {
                e.preventDefault();
                addComment();
            });
            
            // Fechar modais ao clicar fora deles
            window.addEventListener('click', (e) => {
                if (e.target === taskModal) {
                    taskModal.style.display = 'none';
                }
                if (e.target === commentsModal) {
                    commentsModal.style.display = 'none';
                }
            });
        }
        
        function updateDateDisplay() {
            const day = currentDate.getDate();
            const month = monthNames[currentDate.getMonth()];
            const year = currentDate.getFullYear();
            const weekday = dayNames[currentDate.getDay()];
            
            currentDateEl.textContent = `${weekday}, ${day} de ${month} de ${year}`;
        }
        
        function formatDate(date) {
            const day = date.getDate().toString().padStart(2, '0');
            const month = (date.getMonth() + 1).toString().padStart(2, '0');
            const year = date.getFullYear();
            
            return `${year}-${month}-${day}`;
        }
        
        function formatTime(timeString) {
            // Converter formato 24h (HH:MM) para exibição amigável
            const [hours, minutes] = timeString.split(':');
            return `${hours}:${minutes}`;
        }
        
        function isToday(date) {
            const today = new Date();
            return date.getDate() === today.getDate() && 
                   date.getMonth() === today.getMonth() && 
                   date.getFullYear() === today.getFullYear();
        }
        
        function isPast(date) {
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            date.setHours(0, 0, 0, 0);
            return date < today;
        }
        
        // Manipulação de Tarefas
        function loadTasks() {
            const storedTasks = localStorage.getItem('agenda_tasks');
            tasks = storedTasks ? JSON.parse(storedTasks) : [];
            
            // Converter strings de data para objetos Date
            tasks.forEach(task => {
                task.date = new Date(task.date);
                if (task.realStartTime) {
                    task.realStartTime = new Date(task.realStartTime);
                }
                if (task.realEndTime) {
                    task.realEndTime = new Date(task.realEndTime);
                }
            });
        }
        
        function saveTasks() {
            localStorage.setItem('agenda_tasks', JSON.stringify(tasks));
        }
        
        function openTaskModal(taskId = null) {
            // Resetar formulário
            taskForm.reset();
            
            if (taskId) {
                // Edição de tarefa existente
                const task = tasks.find(t => t.id === taskId);
                if (task) {
                    taskModalTitle.textContent = 'Editar Tarefa';
                    taskIdInput.value = task.id;
                    taskTitleInput.value = task.title;
                    taskDescriptionInput.value = task.description || '';
                    taskStartTimeInput.value = task.startTime;
                    taskEndTimeInput.value = task.endTime;
                    taskPriorityInput.value = task.priority;
                    
                    // Configurar recorrência
                    taskRecurrentInput.checked = task.recurrent;
                    if (task.recurrent) {
                        recurrenceOptions.classList.remove('hidden');
                        
                        if (task.recurrenceType === 'daily') {
                            recurrenceDailyInput.checked = true;
                            specificDays.classList.add('hidden');
                        } else {
                            recurrenceSpecificInput.checked = true;
                            specificDays.classList.remove('hidden');
                            
                            // Marcar dias específicos
                            const dayCheckboxes = document.querySelectorAll('.day-checkbox');
                            dayCheckboxes.forEach(checkbox => {
                                checkbox.checked = task.recurringDays && task.recurringDays.includes(parseInt(checkbox.value));
                            });
                        }
                    } else {
                        recurrenceOptions.classList.add('hidden');
                    }
                    
                    editingTaskId = taskId;
                }
            } else {
                // Nova tarefa
                taskModalTitle.textContent = 'Adicionar Nova Tarefa';
                taskIdInput.value = '';
                
                // Definir horário padrão para hora atual arredondada para a próxima hora
                const now = new Date();
                const nextHour = new Date(now.getFullYear(), now.getMonth(), now.getDate(), now.getHours() + 1, 0);
                const endHour = new Date(nextHour.getTime() + 60 * 60 * 1000);
                
                taskStartTimeInput.value = `${nextHour.getHours().toString().padStart(2, '0')}:00`;
                taskEndTimeInput.value = `${endHour.getHours().toString().padStart(2, '0')}:00`;
                
                // Resetar recorrência
                taskRecurrentInput.checked = false;
                recurrenceOptions.classList.add('hidden');
                specificDays.classList.add('hidden');
                
                editingTaskId = null;
            }
            
            taskModal.style.display = 'flex';
        }
        
        function saveTask() {
            const title = taskTitleInput.value.trim();
            const description = taskDescriptionInput.value.trim();
            const startTime = taskStartTimeInput.value;
            const endTime = taskEndTimeInput.value;
            const priority = taskPriorityInput.value;
            const recurrent = taskRecurrentInput.checked;
            
            // Validar horários
            if (startTime >= endTime) {
                alert('O horário de início deve ser anterior ao horário de fim.');
                return;
            }
            
            // Configurar recorrência
            let recurrenceType = null;
            let recurringDays = null;
            
            if (recurrent) {
                recurrenceType = recurrenceDailyInput.checked ? 'daily' : 'specific';
                
                if (recurrenceType === 'specific') {
                    recurringDays = [];
                    const dayCheckboxes = document.querySelectorAll('.day-checkbox:checked');
                    dayCheckboxes.forEach(checkbox => {
                        recurringDays.push(parseInt(checkbox.value));
                    });
                    
                    if (recurringDays.length === 0) {
                        alert('Selecione pelo menos um dia para recorrência específica.');
                        return;
                    }
                }
            }
            
            if (editingTaskId) {
                // Atualizar tarefa existente
                const taskIndex = tasks.findIndex(t => t.id === editingTaskId);
                
                if (taskIndex !== -1) {
                    tasks[taskIndex] = {
                        ...tasks[taskIndex],
                        title,
                        description,
                        startTime,
                        endTime,
                        priority,
                        recurrent,
                        recurrenceType,
                        recurringDays
                    };
                    
                    // Se a tarefa for recorrente, atualizar ou criar instâncias futuras
                    if (recurrent) {
                        updateRecurringInstances(tasks[taskIndex]);
                    }
                }
            } else {
                // Criar nova tarefa
                const newTask = {
                    id: Date.now().toString(),
                    date: new Date(currentDate),
                    title,
                    description,
                    startTime,
                    endTime,
                    priority,
                    status: 'pending',
                    comments: [],
                    recurrent,
                    recurrenceType,
                    recurringDays
                };
                
                tasks.push(newTask);
                
                // Se a tarefa for recorrente, criar instâncias futuras
                if (recurrent) {
                    createRecurringInstances(newTask);
                }
            }
            
            // Salvar tarefas e atualizar UI
            saveTasks();
            renderTasks();
            renderWeekView();
            updateStatistics();
            
            // Fechar modal
            taskModal.style.display = 'none';
        }
        
        function createRecurringInstances(task) {
            // Criar instâncias para 30 dias no futuro
            const futureLimit = new Date(currentDate);
            futureLimit.setDate(futureLimit.getDate() + 30);
            
            const startDate = new Date(task.date);
            startDate.setDate(startDate.getDate() + 1); // Começar do dia seguinte
            
            for (let date = new Date(startDate); date <= futureLimit; date.setDate(date.getDate() + 1)) {
                const dayOfWeek = date.getDay(); // 0 = Domingo, 6 = Sábado
                
                // Verificar se a data deve receber uma instância
                if (task.recurrenceType === 'daily' || 
                    (task.recurrenceType === 'specific' && task.recurringDays.includes(dayOfWeek))) {
                    
                    // Criar nova instância
                    const instanceTask = {
                        id: `${task.id}-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,
                        parentTaskId: task.id,
                        date: new Date(date),
                        title: task.title,
                        description: task.description,
                        startTime: task.startTime,
                        endTime: task.endTime,
                        priority: task.priority,
                        status: 'pending',
                        comments: [],
                        recurrent: false // Instâncias não são recorrentes por si só
                    };
                    
                    tasks.push(instanceTask);
                }
            }
        }
        
        function updateRecurringInstances(task) {
            // Atualizar todas as instâncias futuras da tarefa recorrente
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            // Encontrar todas as instâncias futuras
            const futureTasks = tasks.filter(t => 
                t.parentTaskId === task.id && 
                new Date(t.date) >= today
            );
            
            // Atualizar cada instância
            futureTasks.forEach(instanceTask => {
                instanceTask.title = task.title;
                instanceTask.description = task.description;
                instanceTask.startTime = task.startTime;
                instanceTask.endTime = task.endTime;
                instanceTask.priority = task.priority;
            });
            
            // Excluir instâncias que não correspondem mais ao padrão de recorrência
            if (task.recurrenceType === 'specific') {
                tasks = tasks.filter(t => {
                    if (t.parentTaskId === task.id && new Date(t.date) >= today) {
                        const dayOfWeek = new Date(t.date).getDay();
                        return task.recurringDays.includes(dayOfWeek);
                    }
                    return true;
                });
            }
            
            // Criar novas instâncias conforme necessário
            createRecurringInstances(task);
        }
        
        function deleteTask(taskId) {
            const taskIndex = tasks.findIndex(t => t.id === taskId);
            
            if (taskIndex !== -1) {
                const task = tasks[taskIndex];
                
                // Perguntar se o usuário deseja excluir todas as instâncias recorrentes
                if (task.recurrent && confirm("Deseja excluir esta tarefa e todas as suas ocorrências futuras?")) {
                    // Excluir a tarefa principal e todas as instâncias
                    tasks = tasks.filter(t => t.id !== taskId && t.parentTaskId !== taskId);
                } else {
                    // Excluir apenas esta tarefa
                    tasks.splice(taskIndex, 1);
                }
                
                saveTasks();
                renderTasks();
                renderWeekView();
                updateStatistics();
            }
        }
        
        function startTask(taskId) {
            const task = tasks.find(t => t.id === taskId);
            
            if (task) {
                task.status = 'in-progress';
                task.realStartTime = new Date();
                
                saveTasks();
                renderTasks();
            }
        }
        
        function finishTask(taskId) {
            const task = tasks.find(t => t.id === taskId);
            
            if (task) {
                task.status = 'completed';
                task.realEndTime = new Date();
                
                saveTasks();
                renderTasks();
                updateStatistics();
            }
        }
        
        function markTaskStatus(taskId, status) {
            const task = tasks.find(t => t.id === taskId);
            
            if (task) {
                task.status = status;
                
                saveTasks();
                renderTasks();
                updateStatistics();
            }
        }
        
        // Manipulação de Comentários
        function openCommentsModal(taskId) {
            const task = tasks.find(t => t.id === taskId);
            
            if (task) {
                commentTaskIdInput.value = taskId;
                renderComments(task.comments || []);
                commentsModal.style.display = 'flex';
            }
        }
        
        function renderComments(comments) {
            commentsList.innerHTML = '';
            
            if (comments.length === 0) {
                commentsList.innerHTML = '<li class="comment-item">Nenhum comentário ainda.</li>';
                return;
            }
            
            comments.forEach(comment => {
                const commentEl = document.createElement('li');
                commentEl.className = 'comment-item';
                
                const commentTime = new Date(comment.timestamp);
                const timeStr = `${commentTime.getHours().toString().padStart(2, '0')}:${commentTime.getMinutes().toString().padStart(2, '0')}`;
                
                let commentHTML = `
                    <div class="comment-text">${comment.text}</div>
                    <div class="comment-time">${timeStr}</div>
                `;
                
                if (comment.image) {
                    commentHTML += `<img src="${comment.image}" class="comment-image" alt="Imagem do comentário">`;
                }
                
                commentEl.innerHTML = commentHTML;
                commentsList.appendChild(commentEl);
            });
        }
        
        function addComment() {
            const taskId = commentTaskIdInput.value;
            const text = commentTextInput.value.trim();
            const imageFile = commentImageInput.files[0];
            
            if (!text && !imageFile) {
                alert('Adicione um texto ou uma imagem para o comentário.');
                return;
            }
            
            const task = tasks.find(t => t.id === taskId);
            
            if (task) {
                // Verificar limite de 10 comentários
                if (task.comments && task.comments.length >= 10) {
                    alert('Limite de 10 comentários atingido para esta tarefa.');
                    return;
                }
                
                // Inicializar array de comentários se não existir
                if (!task.comments) {
                    task.comments = [];
                }
                
                // Criar o novo comentário
                const newComment = {
                    id: Date.now().toString(),
                    text,
                    timestamp: new Date()
                };
                
                // Processar imagem se fornecida
                if (imageFile) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        newComment.image = e.target.result;
                        
                        // Adicionar comentário e salvar
                        task.comments.push(newComment);
                        saveTasks();
                        renderComments(task.comments);
                        
                        // Limpar formulário
                        commentTextInput.value = '';
                        commentImageInput.value = '';
                    };
                    reader.readAsDataURL(imageFile);
                } else {
                    // Adicionar comentário sem imagem
                    task.comments.push(newComment);
                    saveTasks();
                    renderComments(task.comments);
                    
                    // Limpar formulário
                    commentTextInput.value = '';
                    commentImageInput.value = '';
                }
            }
        }
        
        // Renderização da UI
        function renderTasks() {
            tasksContainer.innerHTML = '';
            
            // Filtrar tarefas para o dia atual
            const currentDateStr = formatDate(currentDate);
            const dayTasks = tasks.filter(task => formatDate(task.date) === currentDateStr);
            
            if (dayTasks.length === 0) {
                tasksContainer.innerHTML = `
                    <div class="alert alert-info">
                        <svg class="icon alert-icon" viewBox="0 0 24 24">
                            <path d="M11 17h2v-6h-2v6zm1-15C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm-1-11h2V6h-2v3z"></path>
                        </svg>
                        <div>Nenhuma tarefa para este dia. Adicione uma nova tarefa clicando no botão +</div>
                    </div>
                `;
                return;
            }
            
            // Ordenar tarefas por horário de início
            dayTasks.sort((a, b) => a.startTime.localeCompare(b.startTime));
            
            // Renderizar cada tarefa
            dayTasks.forEach(task => {
                const taskEl = document.createElement('div');
                taskEl.className = `task-item priority-${task.priority}`;
                taskEl.dataset.id = task.id;
                
                // Verificar se a data é no passado
                const isPastDate = isPast(new Date(task.date));
                const isInProgress = task.status === 'in-progress';
                const isCompleted = task.status === 'completed';
                
                // Ícones de status
                let statusIcon = '';
                if (isCompleted) {
                    statusIcon = `<span class="badge badge-success">Concluída</span>`;
                } else if (isInProgress) {
                    statusIcon = `<span class="badge badge-primary">Em andamento</span>`;
                }
                
                // Renderizar ícone de recorrência se aplicável
                let recurrentIcon = '';
                if (task.recurrent || task.parentTaskId) {
                    recurrentIcon = `
                        <svg class="icon icon-sm" viewBox="0 0 24 24" style="margin-left: 8px; color: #6a3093;">
                            <path d="M12 6v3l4-4-4-4v3c-4.42 0-8 3.58-8 8 0 1.57.46 3.03 1.24 4.26L6.7 14.8c-.45-.83-.7-1.79-.7-2.8 0-3.31 2.69-6 6-6zm6.76 1.74L17.3 9.2c.44.84.7 1.79.7 2.8 0 3.31-2.69 6-6 6v-3l-4 4 4 4v-3c4.42 0 8-3.58 8-8 0-1.57-.46-3.03-1.24-4.26z"></path>
                        </svg>
                    `;
                }
                
                // Renderizar comentários se houver
                let commentsIndicator = '';
                if (task.comments && task.comments.length > 0) {
                    commentsIndicator = `
                        <span class="badge badge-primary" style="margin-left: 8px;">
                            <svg class="icon icon-sm" viewBox="0 0 24 24" style="margin-right: 2px;">
                                <path d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm0 14H6l-2 2V4h16v12z"></path>
                            </svg>
                            ${task.comments.length}
                        </span>
                    `;
                }
                
                // Renderizar informações de tempo real se aplicável
                let realTimeInfo = '';
                if (task.realStartTime && task.realEndTime) {
                    const realStart = new Date(task.realStartTime);
                    const realEnd = new Date(task.realEndTime);
                    
                    const startStr = `${realStart.getHours().toString().padStart(2, '0')}:${realStart.getMinutes().toString().padStart(2, '0')}`;
                    const endStr = `${realEnd.getHours().toString().padStart(2, '0')}:${realEnd.getMinutes().toString().padStart(2, '0')}`;
                    
                    realTimeInfo = `
                        <div class="real-time-info" style="font-size: 0.8rem; color: #666; margin-top: 5px;">
                            <svg class="icon icon-sm" viewBox="0 0 24 24" style="vertical-align: middle; margin-right: 2px;">
                                <path d="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm.5-13H11v6l5.25 3.15.75-1.23-4.5-2.67z"></path>
                            </svg>
                            Executado: ${startStr} - ${endStr}
                        </div>
                    `;
                }
                
                // Construir HTML da tarefa
                taskEl.innerHTML = `
                    <div class="task-header">
                        <div class="task-time">${formatTime(task.startTime)} - ${formatTime(task.endTime)}</div>
                        <h3 class="task-title">${task.title} ${recurrentIcon}</h3>
                        ${statusIcon}
                        ${commentsIndicator}
                    </div>
                    ${task.description ? `<div class="task-description">${task.description}</div>` : ''}
                    ${realTimeInfo}
                    <div class="task-actions">
                        <div class="task-action-buttons">
                            ${!isPastDate && !isCompleted ? `
                                ${!isInProgress ? `
                                    <button class="btn btn-secondary btn-sm start-task-btn">
                                        <svg class="icon icon-sm btn-icon" viewBox="0 0 24 24">
                                            <path d="M8 5v14l11-7z"></path>
                                        </svg>
                                        Iniciar
                                    </button>
                                ` : `
                                    <button class="btn btn-success btn-sm finish-task-btn">
                                        <svg class="icon icon-sm btn-icon" viewBox="0 0 24 24">
                                            <path d="M9 16.2L4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4L9 16.2z"></path>
                                        </svg>
                                        Finalizar
                                    </button>
                                `}
                            ` : ''}
                            
                            <button class="btn btn-secondary btn-sm comments-btn">
                                <svg class="icon icon-sm btn-icon" viewBox="0 0 24 24">
                                    <path d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm0 14H6l-2 2V4h16v12z"></path>
                                </svg>
                                Comentários
                            </button>
                        </div>
                        
                        <div class="task-management">
                            ${!isPastDate && !isInProgress && !isCompleted ? `
                                <button class="btn btn-secondary btn-sm edit-task-btn">
                                    <svg class="icon icon-sm" viewBox="0 0 24 24">
                                        <path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"></path>
                                    </svg>
                                </button>
                                <button class="btn btn-danger btn-sm delete-task-btn">
                                    <svg class="icon icon-sm" viewBox="0 0 24 24">
                                        <path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"></path>
                                    </svg>
                                </button>
                            ` : ''}
                            
                            ${isCompleted ? `
                                <div class="task-status-buttons">
                                    <button class="btn btn-success btn-sm task-ok-btn">OK</button>
                                    <button class="btn btn-danger btn-sm task-nok-btn">NOK</button>
                                </div>
                            ` : ''}
                        </div>
                    </div>
                `;
                
                // Adicionar event listeners
                taskEl.querySelector('.comments-btn')?.addEventListener('click', () => {
                    openCommentsModal(task.id);
                });
                
                taskEl.querySelector('.start-task-btn')?.addEventListener('click', () => {
                    startTask(task.id);
                });
                
                taskEl.querySelector('.finish-task-btn')?.addEventListener('click', () => {
                    finishTask(task.id);
                });
                
                taskEl.querySelector('.edit-task-btn')?.addEventListener('click', () => {
                    openTaskModal(task.id);
                });
                
                taskEl.querySelector('.delete-task-btn')?.addEventListener('click', () => {
                    if (confirm('Tem certeza que deseja excluir esta tarefa?')) {
                        deleteTask(task.id);
                    }
                });
                
                taskEl.querySelector('.task-ok-btn')?.addEventListener('click', () => {
                    markTaskStatus(task.id, 'ok');
                });
                
                taskEl.querySelector('.task-nok-btn')?.addEventListener('click', () => {
                    markTaskStatus(task.id, 'nok');
                });
                
                tasksContainer.appendChild(taskEl);
            });
        }
        
        function renderWeekView() {
            weekViewContainer.innerHTML = '';
            
            // Calcular o primeiro dia da semana (domingo)
            const firstDayOfWeek = new Date(currentDate);
            const currentDayOfWeek = currentDate.getDay(); // 0 = domingo, 6 = sábado
            firstDayOfWeek.setDate(currentDate.getDate() - currentDayOfWeek);
            
            // Criar elementos para cada dia da semana
            for (let i = 0; i < 7; i++) {
                const date = new Date(firstDayOfWeek);
                date.setDate(firstDayOfWeek.getDate() + i);
                
                const dateStr = formatDate(date);
                const isCurrentDate = date.getDate() === currentDate.getDate() && 
                                       date.getMonth() === currentDate.getMonth() && 
                                       date.getFullYear() === currentDate.getFullYear();
                
                // Filtrar tarefas para este dia
                const dayTasks = tasks.filter(task => formatDate(task.date) === dateStr);
                
                // Ordenar tarefas por horário de início
                dayTasks.sort((a, b) => a.startTime.localeCompare(b.startTime));
                
                // Criar elemento do dia
                const dayEl = document.createElement('div');
                dayEl.className = 'week-day';
                
                if (isCurrentDate) {
                    dayEl.style.borderColor = '#6a3093';
                    dayEl.style.borderWidth = '2px';
                }
                
                // Cabeçalho do dia
                const headerEl = document.createElement('div');
                headerEl.className = 'week-day-header';
                headerEl.innerHTML = `
                    <div class="day-name">${shortDayNames[i]}</div>
                    <div class="day-date">${date.getDate()}/${date.getMonth() + 1}</div>
                `;
                
                // Container de tarefas
                const tasksEl = document.createElement('div');
                tasksEl.className = 'day-tasks';
                
                // Adicionar tarefas
                if (dayTasks.length === 0) {
                    tasksEl.innerHTML = '<div class="week-task" style="color: #999; text-align: center;">Sem tarefas</div>';
                } else {
                    dayTasks.forEach(task => {
                        const taskEl = document.createElement('div');
                        taskEl.className = `week-task priority-${task.priority}`;
                        taskEl.innerHTML = `
                            <div class="week-task-time">${formatTime(task.startTime)}</div>
                            <div class="week-task-title">${task.title}</div>
                        `;
                        
                        // Adicionar evento para navegar para o dia ao clicar na tarefa
                        taskEl.addEventListener('click', () => {
                            currentDate = new Date(date);
                            updateDateDisplay();
                            renderTasks();
                            
                            // Mudar para a aba Agenda
                            document.querySelector('.nav-tab[data-tab="agenda"]').click();
                        });
                        
                        tasksEl.appendChild(taskEl);
                    });
                }
                
                // Montar o elemento do dia
                dayEl.appendChild(headerEl);
                dayEl.appendChild(tasksEl);
                weekViewContainer.appendChild(dayEl);
            }
        }
        
        function updateStatistics() {
            // Calcular início e fim da semana atual
            const today = new Date();
            const startOfWeek = new Date(today);
            startOfWeek.setDate(today.getDate() - today.getDay()); // Domingo
            startOfWeek.setHours(0, 0, 0, 0);
            
            const endOfWeek = new Date(startOfWeek);
            endOfWeek.setDate(startOfWeek.getDate() + 6); // Sábado
            endOfWeek.setHours(23, 59, 59, 999);
            
            // Filtrar tarefas da semana atual
            const weekTasks = tasks.filter(task => {
                const taskDate = new Date(task.date);
                return taskDate >= startOfWeek && taskDate <= endOfWeek;
            });
            
            // Calcular estatísticas
            const totalTasks = weekTasks.length;
            const completedTasks = weekTasks.filter(task => 
                task.status === 'completed' || task.status === 'ok' || task.status === 'nok'
            ).length;
            
            const tasksWithRealTime = weekTasks.filter(task => 
                task.realStartTime && task.realEndTime
            );
            
            // Verificar pontualidade
            let onTimeTasks = 0;
            tasksWithRealTime.forEach(task => {
                const plannedStart = new Date(`${formatDate(task.date)}T${task.startTime}`);
                const plannedEnd = new Date(`${formatDate(task.date)}T${task.endTime}`);
                const realStart = new Date(task.realStartTime);
                const realEnd = new Date(task.realEndTime);
                
                // Considerar pontual se começou até 5 minutos depois do planejado
                // e terminou antes ou até 10 minutos depois do planejado
                const startDiff = (realStart - plannedStart) / (1000 * 60); // diferença em minutos
                const endDiff = (realEnd - plannedEnd) / (1000 * 60);
                
                if (startDiff <= 5 && endDiff <= 10) {
                    onTimeTasks++;
                }
            });
            
            // Calcular distribuição por prioridade
            const criticalTasks = weekTasks.filter(task => task.priority === 'critical').length;
            const attentionTasks = weekTasks.filter(task => task.priority === 'attention').length;
            const normalTasks = weekTasks.filter(task => task.priority === 'normal').length;
            
            // Calcular percentuais
            const criticalPercent = totalTasks > 0 ? Math.round((criticalTasks / totalTasks) * 100) : 0;
            const attentionPercent = totalTasks > 0 ? Math.round((attentionTasks / totalTasks) * 100) : 0;
            const normalPercent = totalTasks > 0 ? Math.round((normalTasks / totalTasks) * 100) : 0;
            
            // Atualizar elementos da UI
            tasksCompletedEl.textContent = completedTasks;
            tasksCompletedRatioEl.textContent = `concluídas de ${totalTasks} tarefas`;
            
            tasksOnTimeEl.textContent = onTimeTasks;
            tasksOnTimeRatioEl.textContent = `no horário de ${tasksWithRealTime.length} executadas`;
            
            priorityCriticalPercentEl.textContent = `${criticalPercent}%`;
            priorityAttentionPercentEl.textContent = `${attentionPercent}%`;
            priorityNormalPercentEl.textContent = `${normalPercent}%`;
        }
    </script>
</body>
</html></textarea>
        </div>
        
        <div class="mt-6">
            <div class="bg-yellow-100 border-l-4 border-yellow-500 p-4 rounded-lg mb-4">
                <h3 class="font-bold text-yellow-700">Lembrete Importante:</h3>
                <p>Depois de copiar o código, certifique-se de salvá-lo com a extensão <strong>.html</strong> (exemplo: "agenda_diaria.html") para que funcione corretamente.</p>
            </div>
            
            <button id="downloadBtn" class="bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-6 rounded-lg w-full flex items-center justify-center mt-4">
                <i class="fas fa-download mr-2"></i> Baixar como arquivo HTML
            </button>
        </div>
    </div>
    
    <script>
        document.getElementById('selectAllBtn').addEventListener('click', function() {
            const sourceCode = document.getElementById('sourceCode');
            sourceCode.select();
            sourceCode.setSelectionRange(0, 99999); // Para dispositivos móveis
            document.execCommand('copy');
            alert('Código copiado para a área de transferência!');
        });
        
        document.getElementById('downloadBtn').addEventListener('click', function() {
            const sourceCode = document.getElementById('sourceCode').value;
            const blob = new Blob([sourceCode], {type: 'text/html'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'agenda_diaria.html';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        });
    </script>
</body>
</html>
